---
title: "[Spring] ìŠ¤í”„ë§ ì…ë¬¸ ì›¹ ê°œë°œ ê¸°ì´ˆ(13)"
excerpt: "íšŒì› ê´€ë¦¬ ì˜ˆì œ - ë°±ì—”ë“œ ê°œë°œ(íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸)"

categories:
  - Backend
tags:
  - [backend, spring, ì…ë¬¸, ê°•ì˜, ultimate, Java, gradle, dependency, injection, í…ŒìŠ¤íŠ¸, ì¤‘ë³µ]

permalink: /backend/spring13

toc: true
toc_sticky: true
 
date: 2022-08-02
last_modified_at: 2022-08-02
---

# íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒì„±

<aside>
ğŸ’¡ ê¿€íŒ : Ctrl + Shift + T ëˆ„ë¥´ë©´ í…ŒìŠ¤íŠ¸ ìƒì„±í•´ì¤Œ.

</aside>

![spring45](https://jsw6701.github.io/assets/images/posts_img/spring/45.png)

![spring46](https://jsw6701.github.io/assets/images/posts_img/spring/46.png)

ë§Œë“¤ì—ˆë‹¤ë©´ ì´ì œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì ì–´ë³¼í…ë° êµ³ì´ ì˜ì–´ê¶Œ ì‚¬ëŒë“¤ê³¼ í”„ë¡œì íŠ¸ë¥¼ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ë©´ í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ë¹Œë“œì— ë“¤ì–´ê°€ì§€ ì•Šìœ¼ë¯€ë¡œ í•¨ìˆ˜ ì´ë¦„ì„ í•œê¸€ë¡œ ì ì–´ì¤˜ë„ ëœë‹¤.

join = íšŒì›ê°€ì… ì´ëŸ° í˜•ì‹ìœ¼ë¡œ ë°”ê¿”ì¤˜ë„ ëœë‹¤ëŠ” ëœ»ì´ë‹¤.

### ì½”ë“œ í˜•ì‹

ì´ì œ íšŒì›ê°€ì…ì„ ë§Œë“¤ì–´ë³¼ ê²ƒì¸ë°, í˜•ì‹ì„ ë§ì¶°ì„œ í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

given, when, then = â€œë¬´ì—‡ì¸ê°€ ì£¼ì–´ì¡ŒëŠ”ë°, ì´ê±¸ ì‹¤í–‰í–ˆì„ ë•Œ, ê²°ê³¼ê°€ ì´ê²Œ ë‚˜ì™€ì•¼ í•´â€ í•˜ëŠ” í˜•ì‹ì´ë‹¤.

í•˜ì§€ë§Œ ê·¸ëƒ¥ ì ˆì°¨ëŒ€ë¡œ ì½”ë”©í•œë‹¤ê³  ì´í•´í•˜ëŠ”ê²Œ ë„“ì€ ë²”ì£¼ë¡œ ë³´ë©´ í¸í•  ê²ƒ ê°™ë‹¤. ì € ì˜ë¯¸ì— êµ­í•œë˜ì§€ ì•Šê³  ì´í•´í•˜ì.

### íšŒì›ê°€ì… ë§Œë“¤ê¸°

ì´ì œ íšŒì›ê°€ì…ì„ ë§Œë“¤ì–´ë³´ì.

1. ì£¼ì–´ì§„ ê²ƒ : ë©¤ë²„ë¥¼ ìƒˆë¡œ ë§Œë“¤ê³  ì´ë¦„ì„ ì €ì¥í•œë‹¤.
2. ê²€ì¦í•˜ê³  ì‹¶ì€ ê²ƒ : memberServiceë¡œ memberë¥¼ ì €ì¥í•˜ê³  ë¦¬í„´ê°’ìœ¼ë¡œ ë‚˜ì˜¤ëŠ” Idë¥¼ saveIdì— ì €ì¥í•œë‹¤.
3. ê²€ì¦ ë°©ë²• : saveIdë¡œ memberServiceì— ì €ì¥í•œ Nameê³¼ memberì˜ Nameì´ ê°™ì€ì§€ ê²€ì¦í•œë‹¤.

<aside>
ğŸ’¡ ê¿€íŒ : static import ë‹¨ì¶•í‚¤ëŠ” Alt + Enter ì´ë‹¤.

</aside>

```java
MemberService memberService = new MemberService();

@Test
void íšŒì›ê°€ì…() {
    //given
    Member member = new Member();
    member.setName("hello");
    //when
    Long saveId = memberService.join(member);
    //then
    Member findMember = memberService.findOne(saveId).get();
    assertThat(member.getName()).isEqualTo(findMember.getName());
}
```

![spring47](https://jsw6701.github.io/assets/images/posts_img/spring/47.png)

### ì¤‘ë³µíšŒì›ì˜ˆì™¸ í…ŒìŠ¤íŠ¸ (Try-catch)

í•˜ì§€ë§Œ ì´ë ‡ê²Œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì§ ë‹¤ë©´ ë„ˆë¬´ í‰ë²”í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¼ê³  í•  ìˆ˜ ìˆë‹¤.

í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì˜ˆì™¸ë¡œ ë°œìƒí•˜ëŠ” ë¶€ë¶„ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤.

ê·¸ë˜ì„œ ì¤‘ë³µíšŒì›ì˜ˆì™¸ì˜ ê²½ìš°ë¥¼ í…ŒìŠ¤íŠ¸ í•´ë´ì•¼í•œë‹¤.

try-catchë¬¸ì„ ì´ìš©í•˜ì—¬ ì¤‘ë³µíšŒì›ì„ í…ŒìŠ¤íŠ¸í•œë‹¤.

MemberServiceì—ì„œ join ë©”ì„œë“œì— ë“¤ì–´ê°€ìˆëŠ” ì¤‘ë³µ íšŒì› ê²€ì¦ ê¸°ëŠ¥ì€ validateDuplicateMemberì¸ë° IllegalStateExceptionì„ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.ë¡œ ë˜ì§€ê¸°ì— catchì—ë„ IllegalStateExceptionìœ¼ë¡œ ì¡ì•„ì¤€ë‹¤.

```java
@Test
public void ì¤‘ë³µíšŒì›ì˜ˆì™¸(){
    //given
    Member member1 = new Member();
    member1.setName("spring");
    Member member2 = new Member();
    member2.setName("spring");
    //when
    memberService.join(member1);
    try{
        memberService.join(member2);
        fail();
    }catch (IllegalStateException e){
        assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
    }
    //then
}
```

![spring48](https://jsw6701.github.io/assets/images/posts_img/spring/48.png)

### ì¤‘ë³µíšŒì›í…ŒìŠ¤íŠ¸ (assertThrows)

í•˜ì§€ë§Œ try-catchë¬¸ì´ ì• ë§¤í•  ê²½ìš° assertThrowsë¥¼ ì‚¬ìš©í•œë‹¤.

<aside>
ğŸ’¡ ê¿€íŒ : Ctrl + Shift + / í•˜ë©´ ë¸”ë¡ ì£¼ì„ì²˜ë¦¬ê°€ ëœë‹¤. Ctrl + / ëŠ” ì¤„ë³„ë¡œ ëª¨ë‘ ì£¼ì„ì²˜ë¦¬ê°€ ëœë‹¤.

</aside>

ì•„ê¹Œ ì‚¬ìš©í–ˆë˜ try-catchë¬¸ì€ ì ì‹œ ì£¼ì„ì²˜ë¦¬í•´ë‘ê³  ì§œë³´ì.

```java
assertThrows(IllegalStateException.class, () -> memberService.join(member2));
```

ì½”ë“œë¥¼ ì„¤ëª…í•˜ìë©´ ì˜¤ë¥¸ìª½ì— ìˆëŠ” ëŒë‹¤ì‹ ë¡œì§ì„ íƒœìš°ë©´ ì™¼ìª½ì— IllegalStateExceptionì˜ˆì™¸ê°€ í„°ì ¸ì•¼í•œë‹¤ëŠ” ëœ»ì´ë‹¤.

ë‚˜ëŠ” ê°•ì˜ì—ì„œì™€ ë‹¤ë¥´ê²Œ assertThrowsê°€ ë°”ë¡œ ì¸ì‹ì´ ì•ˆë˜ì—ˆëŠ”ë°, ê·¸ ì´ìœ ëŠ” `import static org.junit.jupiter.api.Assertions.*assertThrows*;` ë¥¼ import í•´ì¤˜ì•¼í–ˆë‹¤.

ë§Œì•½ ë‚˜ì²˜ëŸ¼ ë˜ì§€ ì•ŠëŠ” ì‚¬ëŒë“¤ì€ ì•ì— Assertions.assertThrowsë¡œ ë§Œë“¤ê³  alt + enterë¥¼ ì´ìš©í•˜ì—¬ í¸í•˜ê²Œ importë¥¼ í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒì´ë‹¤.

ê·¸ëŸ¼ ì´ë ‡ê²Œ ìƒê°í•  ìˆ˜ ìˆë‹¤.

ì´ì „ try - catchë¬¸ì„ ì‚¬ìš©í•  ê²½ìš°ì—ëŠ” ë¬¸ìì—´ì„ ë¹„êµí•  ìˆ˜ ìˆì—ˆëŠ”ë°,  assertThrowsë¥¼ ì‚¬ìš©í•˜ë©´ ë¶ˆê°€ëŠ¥í•œê°€?

ê°€ëŠ¥í•˜ë‹¤. Ctrl + Alt + V ë¥¼ ëˆŒëŸ¬ì£¼ë©´ ìë™ìœ¼ë¡œ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤ëŠ” ê¿€íŒì„ ë‹¤ì‹œ ì‚¬ìš©í•˜ë©´ IllegalStateExceptionìœ¼ë¡œ ì„ ì–¸ë  ê²ƒì´ë‹¤.

ê·¸ê²ƒì„ ë¹„êµí•´ì£¼ë©´ ëœë‹¤.

```java
IllegalStateException e = assertThrows(IllegalStateException.class, () -> memberService.join(member2));

assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
```

![spring49](https://jsw6701.github.io/assets/images/posts_img/spring/49.png)

ì´ì œ ì´ì „ì— í–ˆë˜ í…ŒìŠ¤íŠ¸ì½”ë“œì™€ ë§ˆì°¬ê°€ì§€ë¡œ clearë¥¼ í•´ì¤˜ì•¼í•œë‹¤.

```java
MemoryMemberRepository memberRepository= new MemoryMemberRepository();

@AfterEach
public void afterEach(){
    memberRepository.clearStore();
}
```

ì´ì œëŠ” íšŒì›ê°€ì…ì— ìˆë˜ setNameì˜ helloë¥¼ springìœ¼ë¡œ ë°”ê¾¸ë”ë¼ë„ dbê°€ ëª¨ë‘ ë‚ ë¼ê°”ê¸°ì— ì „ì²´ ìˆ˜í–‰ì— ë¬¸ì œê°€ ì—†ë‹¤. í•œë²ˆ springìœ¼ë¡œ ë°”ê¾¸ê³  ì „ì²´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì.

![spring50](https://jsw6701.github.io/assets/images/posts_img/spring/50.png)

<aside>
ğŸ’¡ ê¿€íŒ : Ctrl + R ì„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì´ì „ì— ìˆ˜í–‰í–ˆë˜ ë‚´ìš©ì„ ë‹¤ì‹œ ìˆ˜í–‰ì‹œì¼œì¤€ë‹¤.

</aside>

### Dependency Injection

ì—¬ê¸°ì„œ ê·¼ë° êµ³ì´ memberRepository ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•´ì•¼í•˜ëƒëŠ” ì˜ë¬¸ì ì´ ìƒê¸´ë‹¤.

MemberServiceë¡œ ì´ë™í•˜ì.

ë¨¼ì € MemberServiceì— new í•˜ê³  ìˆëŠ” MemberRepositoryë¥¼ ê³ ì³ì¤˜ì•¼í•œë‹¤.

ê·¸ë¦¬ê³  ë‚˜ì„œ Alt + Insertë¥¼ í†µí•´ ìƒì„±ìë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

```java
private final MemberRepository memberRepository;

public MemberService(MemberRepository memberRepository) {
    this.memberRepository = memberRepository;
}
```

ì´ë ‡ê²Œ ë°”ë€Œë©´ MemberServiceì—ì„œ ì§ì ‘ new í•˜ì§€ ì•Šê³  ì™¸ë¶€ì—ì„œ memberRepositoryë¥¼ ë„£ì–´ì£¼ëŠ” í˜•ì‹ì´ ëœë‹¤.

ì´ëŸ°ê²ƒì„ ìš°ë¦¬ëŠ” ì˜ì¡´ì„± ì£¼ì…(Dependency Injection)ì´ë¼ê³  í•œë‹¤.

ì´ì œ ë‹¤ì‹œ MemberServiceTestë¡œ ì´ë™í•˜ì.

MemberServiceì™€ MemoryMemberRepositoryì˜ newë¥¼ ì œê±°í•´ì¤€ë‹¤.

ë‹¤ìŒ @BeforeEachë¥¼ ì´ìš©í•´ ì‹œì‘í•˜ê¸° ì „ë§ˆë‹¤ ì‹¤í–‰í•˜ëŠ” ì½”ë“œë¥¼ ì§œì¤€ë‹¤.

ê·¸ ì•ˆì—ì„œ memberRepositoryì˜ newë¥¼ í•˜ê³ , memberService ì•ˆì— new í–ˆë˜ memberRepositoryë¥¼ ë„£ì–´ì¤€ë‹¤.

```java
MemberService memberService;
MemoryMemberRepository memberRepository;

@BeforeEach
public void beforeEach(){
    memberRepository = new MemoryMemberRepository();
    memberService = new MemberService(memberRepository);
}
```

### ìµœì¢…ì½”ë“œ

MemberServiceTest.java

```java
import mess.hellospring.domain.Member;
import mess.hellospring.domain.MemoryMemberRepository;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertThrows;

class MemberServiceTest {

    MemberService memberService;
    MemoryMemberRepository memberRepository;

    @BeforeEach
    public void beforeEach(){
        memberRepository = new MemoryMemberRepository();
        memberService = new MemberService(memberRepository);
    }

    @AfterEach
    public void afterEach(){
        memberRepository.clearStore();
    }

    @Test
    void íšŒì›ê°€ì…() {
        //given
        Member member = new Member();
        member.setName("spring");
        //when
        Long saveId = memberService.join(member);
        //then
        Member findMember = memberService.findOne(saveId).get();
        assertThat(member.getName()).isEqualTo(findMember.getName());
    }

    @Test
    public void ì¤‘ë³µíšŒì›ì˜ˆì™¸(){
        //given
        Member member1 = new Member();
        member1.setName("spring");
        Member member2 = new Member();
        member2.setName("spring");
        //when
        memberService.join(member1);

        IllegalStateException e = assertThrows(IllegalStateException.class, () -> memberService.join(member2));

        assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");

        /*try{
            memberService.join(member2);
            fail();
        }catch (IllegalStateException e){
            assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
        }*/
        //then
    }

    @Test
    void íšŒì›ì°¾ê¸°() {

    }

    @Test
    void findOne() {

    }
}
```

MemberService.java

```java
import mess.hellospring.domain.Member;
import mess.hellospring.repository.MemberRepository;

import java.util.List;
import java.util.Optional;

public class MemberService {
    private final MemberRepository memberRepository;

    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    /**
     * íšŒì› ê°€ì…
     */
    public Long join(Member member){
        validateDuplicateMember(member); //ì¤‘ë³µ íšŒì› ê²€ì¦
        memberRepository.save(member);
        return member.getId();
    }

    private void validateDuplicateMember(Member member) {
        memberRepository.findByName(member.getName())
                .ifPresent(m -> {
                    throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
                });
    }

    /**
     * ì „ì²´ íšŒì› ì¡°íšŒ
     */
    public List<Member> findMembers(){
        return memberRepository.findAll();
    }

    public Optional<Member> findOne(Long memberId){
        return memberRepository.findById(memberId);
    }
}
```