---
title: "[Spring] ìŠ¤í”„ë§ ì…ë¬¸ ì›¹ ê°œë°œ ê¸°ì´ˆ(12)"
excerpt: "íšŒì› ê´€ë¦¬ ì˜ˆì œ - ë°±ì—”ë“œ ê°œë°œ(íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ)"

categories:
  - Backend
tags:
  - [backend, spring, ì…ë¬¸, ê°•ì˜, ultimate, Java, gradle, íšŒì›, ì„œë¹„ìŠ¤]

permalink: /backend/spring12

toc: true
toc_sticky: true
 
date: 2022-07-27
last_modified_at: 2022-07-27
---

# íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ

ë¨¼ì € sevice íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ì–´ì£¼ê³ , MemberServiceë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

![spring44](https://jsw6701.github.io/assets/images/posts_img/spring/44.png)

íšŒì› ì„œë¹„ìŠ¤ì´ë¯€ë¡œ ë‹¹ì—°íˆ íšŒì› ë¦¬í¬ì§€í† ë¦¬ê°€ ë‹¹ì—°íˆ í•„ìš”í•˜ë‹¤.

```java
private final MemberRepository memberRepository = new MemoryMemberRepository();
```

ë‹¤ìŒìœ¼ë¡œ íšŒì›ê°€ì…ì„ ë§Œë“¤ì–´ë³¸ë‹¤.

íšŒì›ê°€ì…ì€ ë‹¨ìˆœí•˜ê²Œ memberRepositoryì— saveí•´ì£¼ë©´ ëœë‹¤.

ê·¸ë¦¬ê³  ì„ì˜ë¡œ ì¼ë‹¨ member.getIdë¥¼ í†µí•´ ì•„ì´ë””ë¥¼ ë°˜í™˜í•´ì¤€ë‹¤.

```java
public Long join(Member member){
    memberRepository.save(member);
    return member.getId();
}
```

í•˜ì§€ë§Œ íšŒì›ê°€ì…ì„ í•  ë•Œ ìš°ë¦¬ëŠ” ì¤‘ë³µëœ ì´ë¦„ì€ ê°€ì…í•˜ì§€ ëª»í•˜ê²Œ í•œë‹¤ëŠ” ì¡°ê±´ì´ ìˆì—ˆë‹¤.

<aside>
ğŸ’¡ ê¿€íŒ : Ctrl + Shift + V í•˜ë©´ ë³€ìˆ˜ ì¶”ì¶œí•˜ê¸°ê°€ ëœë‹¤. ì¦‰, ìƒˆë¡œìš´ ë³€ìˆ˜ë¡œ ìë™ìœ¼ë¡œ ì„ ì–¸í•´ì¤€ë‹¤.

</aside>

```java
memberRepository.findByName(member.getName());

										V
			
						 	Ctrl + Alt + V 

										V

Optional<Member> result = memberRepository.findByName(member.getName());
```

ì´ì œ resultì— ë‹´ê¸´ ì´ë¦„ì´ nullì´ ì•„ë‹Œ ì¡´ì¬í•˜ëŠ” ê°’ì´ ìˆë‹¤ë©´ ë¡œì§ì´ ë™ì‘ì„ í•˜ëŠ” ifPresentë¡œ ì‘ì—…í•´ì¤€ë‹¤.

ì›ë˜ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```java
public Long join(Member member){
    //ê°™ì€ ì´ë¦„ì´ ìˆëŠ” ì¤‘ë³µ íšŒì›ì€ ì•ˆëœë‹¤.
    Optional<Member> result = memberRepository.findByName(member.getName());
    result.ifPresent(m -> {
        throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
    });
    memberRepository.save(member);
    return member.getId();
}
```

í•˜ì§€ë§Œ Optionalì´ ë“¤ì–´ìˆëŠ” ê²ƒì´ ì´ì˜ì§€ ì•Šë‹¤ë©´ ì–´ì©Œí”¼ Optionalë¡œ ë°˜í™˜ë  ê²ƒì´ê³  resultëŠ” ì´ë¯¸ ë°˜í™˜ë˜ì—ˆìœ¼ë‹ˆ ì—†ì• ë„ ëœë‹¤.

ë‹¤ì‹œ ë§í•˜ìë©´ findByNameì˜ ê²°ê³¼ëŠ” ì–´ì©Œí”¼ Optionalì´ë‹ˆ ë°”ë¡œ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

```java
public Long join(Member member){
    //ê°™ì€ ì´ë¦„ì´ ìˆëŠ” ì¤‘ë³µ íšŒì›ì€ ì•ˆëœë‹¤.
    memberRepository.findByName(member.getName())
            .ifPresent(m -> {
                throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
            });
    memberRepository.save(member);
    return member.getId();
}
```

í›¨ì”¬ ê¹”ë”í•´ì¡Œë‹¤. í•˜ì§€ë§Œ ì´ëŸ°ì‹ìœ¼ë¡œ findByName ì•„ë˜ë¡œ ë¡œì§ì´ ì­‰ ë‚˜ì˜¨ë‹¤ë©´ ë©”ì„œë“œë¥¼ ë½‘ëŠ”ê²ƒì´ í›¨ì”¬ ì¢‹ë‹¤.

<aside>
ğŸ’¡ ê¿€íŒ : Ctrl + Alt + Mìœ¼ë¡œ ë©”ì„œë“œë¥¼ ë½‘ì•„ë‚¼ ìˆ˜ ìˆë‹¤.

</aside>

```java
public class MemberService {
    private final MemberRepository memberRepository = new MemoryMemberRepository();

    /**
     * íšŒì› ê°€ì…
     */
    public Long join(Member member){
        validateDuplicateMember(member); //ì¤‘ë³µ íšŒì› ê²€ì¦
        memberRepository.save(member);
        return member.getId();
    }

    private void validateDuplicateMember(Member member) {
        memberRepository.findByName(member.getName())
                .ifPresent(m -> {
                    throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
                });
    }
}
```

ì´ë ‡ê²Œ ë³€í•˜ê²Œ ëœë‹¤. í›¨ì”¬ ê¹”ë”í•˜ê³  ì´ìœ ê²ƒ ê°™ë‹¤.

ì´ì œëŠ” ì „ì²´ íšŒì› ì¡°íšŒ ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

ì •ë§ ì‰½ë‹¤. memberRepositoryì— findAll ê¸°ëŠ¥ì„ ì¨ì£¼ê³  findMembers ìì²´ë¥¼ List<Member>ë¡œ ë§Œë“¤ì—ˆê¸°ì— ê·¸ëƒ¥ return í•´ì£¼ë©´ ëì´ë‹¤.

```java
/**
 * ì „ì²´ íšŒì› ì¡°íšŒ
 */
public List<Member> findMembers(){
    return memberRepository.findAll();
}
```

ë§ˆì§€ë§‰ìœ¼ë¡œ ì•„ì´ë””ë¥¼ ì°¾ëŠ” ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ì¤€ë‹¤.

```java
public Optional<Member> findOne(Long memberId){
    return memberRepository.findById(memberId);
}
```